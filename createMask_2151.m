function [BW,maskedImage] = createMask_2151_ImSegmenterwithAC(RGB)
%segmentImage Segment image using auto-generated code from imageSegmenter App
%  [BW,MASKEDIMAGE] = segmentImage(RGB) segments image RGB using
%  auto-generated code from the imageSegmenter App. The final segmentation
%  is returned in BW, and a masked image is returned in MASKEDIMAGE.

% Auto-generated by imageSegmenter app on 11-Jan-2017
%----------------------------------------------------


% Convert RGB image into L*a*b* color space.
X = rgb2lab(RGB);

% Graph Cut
foregroundInd = [642492 652284 769781 862805 970506 1017018 1026810 1043946 1080658 1198151 1244659 1254451 1264243 1271587 1308304 1345024 1364608 1381744 1391536 1398880 1408672 1418464 1428256 1435600 1509055 1528642 1535986 1545782 1555574 1565366 1582502 1599642 1619230 1646158 1655950 1665742 1673086 6343873 6353665 6454033 6461377 6471169 6498097 6534817 6544609 6554401 6591118 6608254 6618046 6662110 6681694 6698830 6718414 6745338 6755130 6772262 6782054 6791846 6818774 6835910 6862838 6892210 6909346 6919138 6926482 6936274 6946066 6963202 6972994 6992578 7009714 7019506 7026850 7046434 7056226 7063570 7083154 7100290 7110082 7127215 7137007 7146799 7163935 7173727 7183519 7190863 ];
backgroundInd = [2094518 4054978 4081903 4091691 4118615 4135751 4155331 4182256 4192044 4218968 4236101 4255685 4263025 4263029 4272817 4282609 4292401 4299745 4309533 4336457 4346249 4363385 4373174 4392758 4409894 4419686 4427030 4436822 4446614 4456406 4965657 5159071 5176215 5276609 5293756 5340279 5367218 5394157 5423548 5514158 5587616 5661075 5741878 5815333 5869196 5942647 6033231 6126262 6207050 6253562 6290282 6361274 6444502 6525282 6562002 6608514 6672162 6735810 6782322 6826386 6863106 6936543 6973259 7036903 7137260 7237621 7311053 7347769 7374694 7391830 7411414 7492194 7528910 7548490 7565626 7612131 7658639 7692904 7712480 7729613 7776117 7785674 7785682 7785686 7785697 7785701 7793048 7793052 7802848 7803038 7812643 7822439 7829787 7839586 7839590 7839747 7849386 7866529 7866663 7876325 7893465 7893580 7903264 7913157 7922859 7940003 7940074 7957143 7957198 7957202 7966935 7966938 7966976 7966979 7966987 7976730 7976734 7976738 7976745 7976753 7976764 ];
L = superpixels(X,20026,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = X;
scaledX(:,:,1) = X(:,:,1) / 100;
scaledX(:,:,2:3) = (X(:,:,2:3) + 100) / 200;
BW = lazysnapping(scaledX,L,foregroundInd,backgroundInd);

% Invert mask
BW = imcomplement(BW);

% Invert mask
BW = imcomplement(BW);

% Fill holes
BW = imfill(BW, 'holes');

% Active contour using Chan-Vese over 15 iterations
iterations = 15;
BW = activecontour(X, BW, iterations, 'Chan-Vese');

% Create masked image.
maskedImage = RGB;
maskedImage(repmat(~BW,[1 1 3])) = 0;